<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Comerciante - Don√° Tu Comida</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: #f8fafc;
            min-height: 100vh;
            color: #1e293b;
        }

        .header {
            background: linear-gradient(135deg, #2563eb, #1d4ed8);
            color: white;
            padding: 20px;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 18px;
            font-weight: bold;
        }

        .comercio-info {
            text-align: right;
            font-size: 14px;
        }

        .comercio-name {
            font-weight: bold;
            margin-bottom: 2px;
        }

        .nav-tabs {
            background: white;
            display: flex;
            border-bottom: 1px solid #e2e8f0;
            position: sticky;
            top: 80px;
            z-index: 90;
        }

        .nav-tab {
            flex: 1;
            padding: 15px 10px;
            text-align: center;
            background: none;
            border: none;
            font-size: 14px;
            font-weight: 500;
            color: #64748b;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }

        .nav-tab.active {
            color: #2563eb;
            border-bottom-color: #2563eb;
            background: #eff6ff;
        }

        .tab-content {
            display: none;
            padding: 20px;
            min-height: calc(100vh - 140px);
        }

        .tab-content.active {
            display: block;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 25px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            border: 1px solid #e2e8f0;
        }

        .stat-number {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-number.pendientes {
            color: #ea580c;
        }

        .stat-number.entregadas {
            color: #16a34a;
        }

        .stat-label {
            font-size: 12px;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .section-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #1e293b;
        }

        .canasta-card {
            background: white;
            border-radius: 12px;
            margin-bottom: 15px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            border: 1px solid #e2e8f0;
        }

        .canasta-header {
            padding: 15px 20px;
            border-bottom: 1px solid #f1f5f9;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .canasta-id {
            font-size: 12px;
            color: #64748b;
            font-family: monospace;
        }

        .canasta-time {
            font-size: 12px;
            color: #64748b;
        }

        .canasta-content {
            padding: 20px;
        }

        .canasta-monto {
            font-size: 20px;
            font-weight: bold;
            color: #16a34a;
            margin-bottom: 10px;
        }

        .canasta-productos {
            font-size: 14px;
            color: #475569;
            margin-bottom: 15px;
            line-height: 1.4;
        }

        .entregar-btn {
            width: 100%;
            background: linear-gradient(135deg, #16a34a, #15803d);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .entregar-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(22, 163, 74, 0.3);
        }

        .entrega-form {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .entrega-form.show {
            display: flex;
        }

        .form-container {
            background: white;
            border-radius: 16px;
            width: 100%;
            max-width: 400px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .form-header {
            background: #16a34a;
            color: white;
            padding: 20px;
            text-align: center;
            border-radius: 16px 16px 0 0;
        }

        .form-title {
            font-size: 18px;
            font-weight: bold;
        }

        .form-body {
            padding: 25px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: bold;
            color: #374151;
            margin-bottom: 8px;
        }

        .form-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #d1d5db;
            border-radius: 8px;
            font-size: 16px;
            outline: none;
            transition: border-color 0.3s ease;
        }

        .form-input:focus {
            border-color: #2563eb;
        }

        .photo-upload {
            border: 2px dashed #cbd5e1;
            border-radius: 12px;
            padding: 30px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .photo-upload:hover {
            border-color: #2563eb;
            background: #f8fafc;
        }

        .photo-upload.has-photo {
            border-color: #16a34a;
            background: #f0fdf4;
        }

        .photo-preview {
            max-width: 100%;
            max-height: 200px;
            border-radius: 8px;
            display: none;
        }

        .photo-upload.has-photo .photo-preview {
            display: block;
        }

        .photo-upload.has-photo .upload-text {
            display: none;
        }

        .upload-text {
            color: #64748b;
            font-size: 14px;
        }

        .upload-icon {
            font-size: 24px;
            margin-bottom: 10px;
            color: #9ca3af;
        }

        .photo-upload.has-photo .upload-icon {
            display: none;
        }

        .form-buttons {
            display: flex;
            gap: 10px;
            margin-top: 25px;
        }

        .btn-cancel {
            flex: 1;
            background: #f1f5f9;
            color: #374151;
            border: none;
            padding: 12px;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
        }

        .btn-submit {
            flex: 2;
            background: linear-gradient(135deg, #16a34a, #15803d);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
        }

        .btn-submit:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }

        .validation-options {
            background: #f0f9ff;
            border: 1px solid #bfdbfe;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .validation-title {
            font-size: 14px;
            font-weight: bold;
            color: #1e40af;
            margin-bottom: 10px;
        }

        .validation-option {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            cursor: pointer;
        }

        .validation-option input[type="radio"] {
            margin-right: 8px;
        }

        .validation-option label {
            font-size: 14px;
            color: #374151;
            cursor: pointer;
        }

        .historial-item {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            border-left: 4px solid #16a34a;
        }

        .historial-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .historial-fecha {
            font-size: 12px;
            color: #64748b;
        }

        .historial-monto {
            font-weight: bold;
            color: #16a34a;
        }

        .historial-persona {
            font-size: 14px;
            color: #374151;
            margin-bottom: 8px;
        }

        .historial-fotos {
            display: flex;
            gap: 8px;
            margin-top: 10px;
        }

        .foto-mini {
            width: 40px;
            height: 40px;
            background: #f3f4f6;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: #6b7280;
            cursor: pointer;
        }

        .foto-mini.uploaded {
            background: #dcfce7;
            color: #16a34a;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #64748b;
        }

        .empty-icon {
            font-size: 48px;
            margin-bottom: 15px;
            opacity: 0.5;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            width: 30px;
            height: 30px;
            border: 3px solid #f3f4f6;
            border-top: 3px solid #2563eb;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #16a34a;
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            font-weight: bold;
            z-index: 1100;
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            display: none;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 25px;
            border-radius: 16px;
            max-width: 90%;
            max-height: 90%;
            text-align: center;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }

        .modal-content h3 {
            margin-bottom: 20px;
            color: #1e293b;
            font-size: 18px;
        }

        .modal-content img {
            max-width: 100%;
            max-height: 400px;
            border-radius: 12px;
            border: 2px solid #e2e8f0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .modal-content .btn-cancel {
            margin-top: 20px;
            background: #6b7280;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        /* Hidden file inputs */
        .file-input {
            display: none;
        }

        /* Estilos adicionales para mejor UX */
        .foto-mini {
            transition: all 0.2s ease;
        }

        .foto-mini:hover {
            transform: scale(1.1);
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .foto-mini:active {
            transform: scale(0.95);
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="header-content">
            <div class="logo">üçû Don√° Tu Comida</div>
            <div class="comercio-info">
                <div class="comercio-name" id="comercio-name">Panader√≠a San Juan</div>
                <div id="comercio-direccion">Av. San Juan 1234</div>
            </div>
        </div>
    </div>

    <!-- Navigation Tabs -->
    <div class="nav-tabs">
        <button class="nav-tab active" onclick="cambiarTab('pendientes')">
            üìã Pendientes
        </button>
        <button class="nav-tab" onclick="cambiarTab('historial')">
            üìä Historial
        </button>
        <button class="nav-tab" onclick="cambiarTab('configuracion')">
            ‚öôÔ∏è Config
        </button>
    </div>

    <!-- Tab: Pendientes -->
    <div class="tab-content active" id="tab-pendientes">
        <!-- Estad√≠sticas -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number pendientes" id="canastas-pendientes">3</div>
                <div class="stat-label">Canastas Pendientes</div>
            </div>
            <div class="stat-card">
                <div class="stat-number entregadas" id="canastas-entregadas-hoy">2</div>
                <div class="stat-label">Entregadas Hoy</div>
            </div>
        </div>

        <!-- Lista de canastas pendientes -->
        <div class="section-title">Canastas para entregar</div>
        
        <div id="lista-canastas">
            <!-- Canasta 1 -->
            <div class="canasta-card">
                <div class="canasta-header">
                    <div class="canasta-id">#DTC-001</div>
                    <div class="canasta-time">Hace 2 horas</div>
                </div>
                <div class="canasta-content">
                    <div class="canasta-monto">$720 a entregar</div>
                    <div class="canasta-productos">Pan lactal + 6 facturas + 4 medialunas + 2 prepizzas</div>
                    <button class="entregar-btn" onclick="abrirFormularioEntrega('DTC-001', 720)">
                        üì¶ Registrar Entrega
                    </button>
                </div>
            </div>

            <!-- Canasta 2 -->
            <div class="canasta-card">
                <div class="canasta-header">
                    <div class="canasta-id">#DTC-002</div>
                    <div class="canasta-time">Hace 4 horas</div>
                </div>
                <div class="canasta-content">
                    <div class="canasta-monto">$720 a entregar</div>
                    <div class="canasta-productos">Pan lactal + 6 facturas + 4 medialunas + 2 prepizzas</div>
                    <button class="entregar-btn" onclick="abrirFormularioEntrega('DTC-002', 720)">
                        üì¶ Registrar Entrega
                    </button>
                </div>
            </div>

            <!-- Canasta 3 -->
            <div class="canasta-card">
                <div class="canasta-header">
                    <div class="canasta-id">#DTC-003</div>
                    <div class="canasta-time">Hace 6 horas</div>
                </div>
                <div class="canasta-content">
                    <div class="canasta-monto">$720 a entregar</div>
                    <div class="canasta-productos">Pan lactal + 6 facturas + 4 medialunas + 2 prepizzas</div>
                    <button class="entregar-btn" onclick="abrirFormularioEntrega('DTC-003', 720)">
                        üì¶ Registrar Entrega
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Tab: Historial -->
    <div class="tab-content" id="tab-historial">
        <div class="section-title">Entregas realizadas</div>
        
        <div id="historial-entregas">
            <div class="historial-item">
                <div class="historial-header">
                    <div class="historial-monto">$720</div>
                    <div class="historial-fecha">Hace 1 hora</div>
                </div>
                <div class="historial-persona">Entregado a: Mar√≠a Gonz√°lez</div>
                <div class="historial-fotos">
                    <div class="foto-mini uploaded" onclick="verFotoHistorial('ticket', 'DTC-004')">üìÑ</div>
                    <div class="foto-mini uploaded" onclick="verFotoHistorial('productos', 'DTC-004')">üì∏</div>
                    <div class="foto-mini uploaded" onclick="verFotoHistorial('persona', 'DTC-004')">üë§</div>
                </div>
            </div>

            <div class="historial-item">
                <div class="historial-header">
                    <div class="historial-monto">$720</div>
                    <div class="historial-fecha">Hace 3 horas</div>
                </div>
                <div class="historial-persona">Entregado a: Carlos Mendez</div>
                <div class="historial-fotos">
                    <div class="foto-mini uploaded" onclick="verFotoHistorial('ticket', 'DTC-005')">üìÑ</div>
                    <div class="foto-mini uploaded" onclick="verFotoHistorial('productos', 'DTC-005')">üì∏</div>
                    <div class="foto-mini uploaded" onclick="verFotoHistorial('persona', 'DTC-005')">üë§</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tab: Configuraci√≥n -->
    <div class="tab-content" id="tab-configuracion">
        <div class="section-title">Configuraci√≥n de Canasta</div>
        
        <div class="canasta-card">
            <div class="canasta-content">
                <div class="form-group">
                    <label class="form-label">Contenido de la canasta ($720)</label>
                    <textarea class="form-input" rows="3" id="contenido-canasta">Pan lactal + 6 facturas + 4 medialunas + 2 prepizzas</textarea>
                </div>
                <button class="entregar-btn" onclick="actualizarCanasta()">
                    üíæ Guardar Cambios
                </button>
            </div>
        </div>

        <div class="section-title" style="margin-top: 30px;">Estad√≠sticas</div>
        
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" style="color: #2563eb;">8</div>
                <div class="stat-label">Personas Ayudadas</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" style="color: #7c3aed;">$5.760</div>
                <div class="stat-label">Total Recibido</div>
            </div>
        </div>
    </div>

    <!-- Formulario de Entrega (Modal) -->
    <div class="entrega-form" id="entrega-form">
        <div class="form-container">
            <div class="form-header">
                <div class="form-title">Registrar Entrega</div>
                <div id="canasta-info">Canasta #DTC-001 ‚Ä¢ $720</div>
            </div>
            
            <div class="form-body">
                <!-- M√©todo de identificaci√≥n -->
                <div class="validation-options">
                    <div class="validation-title">¬øC√≥mo identificaste a la persona?</div>
                    <div class="validation-option">
                        <input type="radio" id="metodo-dni" name="metodo" value="dni">
                        <label for="metodo-dni">DNI / Documento</label>
                    </div>
                    <div class="validation-option">
                        <input type="radio" id="metodo-telefono" name="metodo" value="telefono">
                        <label for="metodo-telefono">N√∫mero de tel√©fono</label>
                    </div>
                    <div class="validation-option">
                        <input type="radio" id="metodo-nombre" name="metodo" value="nombre" checked>
                        <label for="metodo-nombre">Solo nombre y foto</label>
                    </div>
                </div>

                <!-- Datos de la persona -->
                <div class="form-group">
                    <label class="form-label">Nombre de quien recibe</label>
                    <input type="text" class="form-input" id="nombre-persona" placeholder="Nombre y apellido">
                </div>

                <div class="form-group" id="dni-group" style="display: none;">
                    <label class="form-label">N√∫mero de DNI</label>
                    <input type="text" class="form-input" id="dni-persona" placeholder="12345678">
                </div>

                <div class="form-group" id="telefono-group" style="display: none;">
                    <label class="form-label">N√∫mero de tel√©fono</label>
                    <input type="tel" class="form-input" id="telefono-persona" placeholder="11 1234-5678">
                </div>

                <!-- Foto del ticket -->
                <div class="form-group">
                    <label class="form-label">Foto del ticket/recibo *</label>
                    <div class="photo-upload" onclick="seleccionarFoto('ticket')">
                        <div class="upload-icon">üìÑ</div>
                        <div class="upload-text">Toc√° para subir foto del ticket<br><small>(En m√≥vil se abre la c√°mara)</small></div>
                        <img class="photo-preview" id="preview-ticket" alt="Ticket">
                    </div>
                    <input type="file" id="input-ticket" class="file-input" accept="image/*" capture="environment">
                </div>

                <!-- Foto de productos -->
                <div class="form-group">
                    <label class="form-label">Foto de productos entregados *</label>
                    <div class="photo-upload" onclick="seleccionarFoto('productos')">
                        <div class="upload-icon">üì∏</div>
                        <div class="upload-text">Toc√° para subir foto de productos<br><small>(En m√≥vil se abre la c√°mara)</small></div>
                        <img class="photo-preview" id="preview-productos" alt="Productos">
                    </div>
                    <input type="file" id="input-productos" class="file-input" accept="image/*" capture="environment">
                </div>

                <!-- Foto de la persona (opcional) -->
                <div class="form-group">
                    <label class="form-label">Foto de la entrega (opcional)</label>
                    <div class="photo-upload" onclick="seleccionarFoto('persona')">
                        <div class="upload-icon">üë§</div>
                        <div class="upload-text">Toc√° para subir foto de la entrega<br><small>(En m√≥vil se abre la c√°mara)</small></div>
                        <img class="photo-preview" id="preview-persona" alt="Persona">
                    </div>
                    <input type="file" id="input-persona" class="file-input" accept="image/*" capture="environment">
                </div>

                <!-- Botones -->
                <div class="form-buttons">
                    <button class="btn-cancel" onclick="cerrarFormularioEntrega()">Cancelar</button>
                    <button class="btn-submit" id="btn-confirmar" onclick="confirmarEntrega()" disabled>
                        Confirmar Entrega
                    </button>
                </div>

                <!-- Loading -->
                <div class="loading" id="form-loading">
                    <div class="spinner"></div>
                    <div>Validando entrega...</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Variables globales
        let canastas = [
            { id: 'DTC-001', monto: 720, tiempo: 'Hace 2 horas', productos: 'Pan lactal + 6 facturas + 4 medialunas + 2 prepizzas' },
            { id: 'DTC-002', monto: 720, tiempo: 'Hace 4 horas', productos: 'Pan lactal + 6 facturas + 4 medialunas + 2 prepizzas' },
            { id: 'DTC-003', monto: 720, tiempo: 'Hace 6 horas', productos: 'Pan lactal + 6 facturas + 4 medialunas + 2 prepizzas' }
        ];

        let canastasEntregadasHoy = 2;
        let canastasPendientes = 3;
        let entregaActual = null;
        let entregasRealizadas = []; // Array para guardar entregas con fotos reales

        // Cambiar tabs
        function cambiarTab(tab) {
            // Quitar active de todos los tabs y contenidos
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            
            // Activar tab seleccionado
            document.querySelector(`[onclick="cambiarTab('${tab}')"]`).classList.add('active');
            document.getElementById(`tab-${tab}`).classList.add('active');
        }

        // Abrir formulario de entrega
        function abrirFormularioEntrega(canastId, monto) {
            entregaActual = { id: canastId, monto: monto };
            document.getElementById('canasta-info').textContent = `Canasta ${canastId} ‚Ä¢ $${monto}`;
            document.getElementById('entrega-form').classList.add('show');
            document.body.style.overflow = 'hidden';
        }

        // Cerrar formulario de entrega
        function cerrarFormularioEntrega() {
            document.getElementById('entrega-form').classList.remove('show');
            document.body.style.overflow = 'auto';
            limpiarFormulario();
        }

        // Limpiar formulario
        function limpiarFormulario() {
            document.getElementById('nombre-persona').value = '';
            document.getElementById('dni-persona').value = '';
            document.getElementById('telefono-persona').value = '';
            document.querySelectorAll('.photo-upload').forEach(upload => {
                upload.classList.remove('has-photo');
                upload.querySelector('.photo-preview').src = '';
            });
            document.getElementById('btn-confirmar').disabled = true;
        }

        // Manejar m√©todo de identificaci√≥n
        document.querySelectorAll('input[name="metodo"]').forEach(radio => {
            radio.addEventListener('change', function() {
                document.getElementById('dni-group').style.display = this.value === 'dni' ? 'block' : 'none';
                document.getElementById('telefono-group').style.display = this.value === 'telefono' ? 'block' : 'none';
                validarFormulario();
            });
        });

        // Seleccionar foto
        function seleccionarFoto(tipo) {
            document.getElementById(`input-${tipo}`).click();
        }

        // Manejar archivos seleccionados
        document.getElementById('input-ticket').addEventListener('change', function(e) {
            manejarArchivoSeleccionado(e, 'ticket');
        });

        document.getElementById('input-productos').addEventListener('change', function(e) {
            manejarArchivoSeleccionado(e, 'productos');
        });

        document.getElementById('input-persona').addEventListener('change', function(e) {
            manejarArchivoSeleccionado(e, 'persona');
        });

        function manejarArchivoSeleccionado(event, tipo) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const preview = document.getElementById(`preview-${tipo}`);
                    const upload = preview.closest('.photo-upload');
                    
                    preview.src = e.target.result;
                    upload.classList.add('has-photo');
                    
                    validarFormulario();
                };
                reader.readAsDataURL(file);
            }
        }

        // Validar formulario
        function validarFormulario() {
            const nombre = document.getElementById('nombre-persona').value.trim();
            const ticketFoto = document.getElementById('preview-ticket').src;
            const productosFoto = document.getElementById('preview-productos').src;
            
            const formularioValido = nombre && ticketFoto && productosFoto;
            document.getElementById('btn-confirmar').disabled = !formularioValido;
        }

        // Event listeners para validaci√≥n
        document.getElementById('nombre-persona').addEventListener('input', validarFormulario);
        document.getElementById('dni-persona').addEventListener('input', validarFormulario);
        document.getElementById('telefono-persona').addEventListener('input', validarFormulario);

        // Confirmar entrega
        function confirmarEntrega() {
            // Mostrar loading
            document.querySelector('.form-body').style.display = 'none';
            document.getElementById('form-loading').classList.add('show');

            // Simular validaci√≥n autom√°tica
            setTimeout(() => {
                procesarEntrega();
            }, 3000);
        }

        function procesarEntrega() {
            // Obtener datos del formulario
            const nombre = document.getElementById('nombre-persona').value;
            const metodo = document.querySelector('input[name="metodo"]:checked').value;
            let identificador = '';
            
            if (metodo === 'dni') {
                identificador = document.getElementById('dni-persona').value;
            } else if (metodo === 'telefono') {
                identificador = document.getElementById('telefono-persona').value;
            }

            // Crear registro de entrega con fotos reales
            const entrega = {
                id: entregaActual.id,
                monto: entregaActual.monto,
                persona: nombre,
                metodo: metodo,
                identificador: identificador,
                fotos: {
                    ticket: document.getElementById('preview-ticket').src,
                    productos: document.getElementById('preview-productos').src,
                    persona: document.getElementById('preview-persona').src || null
                },
                fecha: new Date(),
                validado: true
            };

            // Guardar en array de entregas realizadas
            entregasRealizadas.unshift(entrega); // Agregar al inicio del array
            
            console.log('üì§ Entrega procesada:', entrega);
            
            // Actualizar listas
            actualizarListas();
            
            // Mostrar notificaci√≥n de √©xito
            mostrarNotificacion('‚úÖ Entrega registrada y validada exitosamente');
            
            // Cerrar formulario
            setTimeout(() => {
                cerrarFormularioEntrega();
                document.querySelector('.form-body').style.display = 'block';
                document.getElementById('form-loading').classList.remove('show');
            }, 1000);

            // Actualizar tablet en tiempo real (simular)
            actualizarTabletTiempoReal();
        }

        function actualizarListas() {
            // Remover canasta de pendientes
            canastas = canastas.filter(c => c.id !== entregaActual.id);
            canastasEntregadasHoy++;
            canastasPendientes = canastas.length;

            // Actualizar displays
            document.getElementById('canastas-pendientes').textContent = canastas.length;
            document.getElementById('canastas-entregadas-hoy').textContent = canastasEntregadasHoy;

            // Recrear lista de canastas pendientes
            actualizarListaCanastas();
            
            // Agregar al historial
            agregarAlHistorial();
        }

        function actualizarListaCanastas() {
            const lista = document.getElementById('lista-canastas');
            
            if (canastas.length === 0) {
                lista.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üéâ</div>
                        <div>¬°Todas las canastas fueron entregadas!</div>
                        <div style="font-size: 14px; margin-top: 5px;">Esperando nuevas donaciones...</div>
                    </div>
                `;
            } else {
                lista.innerHTML = canastas.map(canasta => `
                    <div class="canasta-card">
                        <div class="canasta-header">
                            <div class="canasta-id">#${canasta.id}</div>
                            <div class="canasta-time">${canasta.tiempo}</div>
                        </div>
                        <div class="canasta-content">
                            <div class="canasta-monto">${canasta.monto} a entregar</div>
                            <div class="canasta-productos">${canasta.productos}</div>
                            <button class="entregar-btn" onclick="abrirFormularioEntrega('${canasta.id}', ${canasta.monto})">
                                üì¶ Registrar Entrega
                            </button>
                        </div>
                    </div>
                `).join('');
            }
        }

        function agregarAlHistorial() {
            const historial = document.getElementById('historial-entregas');
            const nombre = document.getElementById('nombre-persona').value;
            
            const nuevoItem = document.createElement('div');
            nuevoItem.className = 'historial-item';
            nuevoItem.innerHTML = `
                <div class="historial-header">
                    <div class="historial-monto">${entregaActual.monto}</div>
                    <div class="historial-fecha">Ahora</div>
                </div>
                <div class="historial-persona">Entregado a: ${nombre}</div>
                <div class="historial-fotos">
                    <div class="foto-mini uploaded" onclick="verFotoHistorial('ticket', '${entregaActual.id}')">üìÑ</div>
                    <div class="foto-mini uploaded" onclick="verFotoHistorial('productos', '${entregaActual.id}')">üì∏</div>
                    <div class="foto-mini uploaded" onclick="verFotoHistorial('persona', '${entregaActual.id}')">üë§</div>
                </div>
            `;
            
            historial.insertBefore(nuevoItem, historial.firstChild);
        }

        function mostrarNotificacion(mensaje) {
            const notificacion = document.createElement('div');
            notificacion.className = 'notification';
            notificacion.textContent = mensaje;
            
            document.body.appendChild(notificacion);
            
            setTimeout(() => {
                notificacion.classList.add('show');
            }, 100);
            
            setTimeout(() => {
                notificacion.classList.remove('show');
                setTimeout(() => {
                    document.body.removeChild(notificacion);
                }, 300);
            }, 3000);
        }

        function actualizarTabletTiempoReal() {
            // Simular comunicaci√≥n con la tablet
            console.log('üì° Enviando actualizaci√≥n a tablet: -1 canasta disponible');
            
            // En la implementaci√≥n real, esto ser√≠a:
            // - WebSocket a la tablet
            // - Actualizaci√≥n de base de datos
            // - Notificaci√≥n push al donante
            
            // Simular mensaje a ventana de tablet si est√° abierta
            if (window.opener) {
                window.opener.postMessage({
                    tipo: 'entrega_realizada',
                    canastas: -1,
                    monto: entregaActual.monto
                }, '*');
            }
        }

        function actualizarCanasta() {
            const nuevoContenido = document.getElementById('contenido-canasta').value;
            
            // Simular actualizaci√≥n
            mostrarNotificacion('üíæ Configuraci√≥n de canasta actualizada');
            
            // En la implementaci√≥n real:
            // - Enviar a servidor para validaci√≥n manual
            // - Actualizar en todas las interfaces
            console.log('üìù Nueva configuraci√≥n de canasta:', nuevoContenido);
        }

        // Simular llegada de nuevas canastas
        function simularNuevaCanasta() {
            const nuevaCanasta = {
                id: `DTC-${String(Math.floor(Math.random() * 1000)).padStart(3, '0')}`,
                monto: 720,
                tiempo: 'Ahora',
                productos: 'Pan lactal + 6 facturas + 4 medialunas + 2 prepizzas'
            };
            
            canastas.push(nuevaCanasta);
            document.getElementById('canastas-pendientes').textContent = canastas.length;
            actualizarListaCanastas();
            
            mostrarNotificacion(`üéâ Nueva canasta disponible: #${nuevaCanasta.id}`);
        }

        // Funci√≥n para ver fotos del historial
        function verFotoHistorial(tipo, entregaId) {
            // Simular carga de foto desde servidor
            const fotoUrl = generarFotoEjemplo(tipo);
            
            // Crear modal para mostrar foto
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'flex';
            modal.innerHTML = `
                <div class="modal-content">
                    <h3>Foto ${tipo} - Entrega ${entregaId}</h3>
                    <img src="${fotoUrl}" alt="${tipo}" style="max-width: 100%; max-height: 400px; border-radius: 8px;">
                    <br><br>
                    <button onclick="this.closest('.modal').remove()" class="btn-cancel">Cerrar</button>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Cerrar al hacer click fuera
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        function generarFotoEjemplo(tipo) {
            // Generar SVG de ejemplo seg√∫n el tipo
            const ejemplos = {
                ticket: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjMwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZjlmYWZiIiBzdHJva2U9IiNlNWU3ZWIiLz48dGV4dCB4PSI1MCUiIHk9IjIwIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMTQiIGZpbGw9IiMzNzQxNTEiIHRleHQtYW5jaG9yPSJtaWRkbGUiPkNPTVBST0JBTlRFPC90ZXh0Pjx0ZXh0IHg9IjEwIiB5PSI1MCIgZm9udC1mYW1pbHk9Im1vbm9zcGFjZSIgZm9udC1zaXplPSIxMCIgZmlsbD0iIzM3NDE1MSI+UGFuYWRlcsOtYSBTYW4gSnVhbjwvdGV4dD48dGV4dCB4PSIxMCIgeT0iNzAiIGZvbnQtZmFtaWx5PSJtb25vc3BhY2UiIGZvbnQtc2l6ZT0iMTAiIGZpbGw9IiMzNzQxNTEiPi0tLS0tLS0tLS0tLS0tLS0tLTwvdGV4dD48dGV4dCB4PSIxMCIgeT0iOTAiIGZvbnQtZmFtaWx5PSJtb25vc3BhY2UiIGZvbnQtc2l6ZT0iMTAiIGZpbGw9IiMzNzQxNTEiPlBhbiBsYWN0YWwgJDE1MDwvdGV4dD48dGV4dCB4PSIxMCIgeT0iMTEwIiBmb250LWZhbWlseT0ibW9ub3NwYWNlIiBmb250LXNpemU9IjEwIiBmaWxsPSIjMzc0MTUxIj5GYWN0dXJhcyAoNikgJDMwMDwvdGV4dD48dGV4dCB4PSIxMCIgeT0iMTMwIiBmb250LWZhbWlseT0ibW9ub3NwYWNlIiBmb250LXNpemU9IjEwIiBmaWxsPSIjMzc0MTUxIj5NZWRpYWx1bmFzICg0KSAkMjAwPC90ZXh0Pjx0ZXh0IHg9IjEwIiB5PSIxNTAiIGZvbnQtZmFtaWx5PSJtb25vc3BhY2UiIGZvbnQtc2l6ZT0iMTAiIGZpbGw9IiMzNzQxNTEiPlByZXBpenphcyAoMikgJDcwPC90ZXh0Pjx0ZXh0IHg9IjEwIiB5PSIxODAiIGZvbnQtZmFtaWx5PSJtb25vc3BhY2UiIGZvbnQtc2l6ZT0iMTAiIGZpbGw9IiMzNzQxNTEiPi0tLS0tLS0tLS0tLS0tLS0tLTwvdGV4dD48dGV4dCB4PSIxMCIgeT0iMjAwIiBmb250LWZhbWlseT0ibW9ub3NwYWNlIiBmb250LXNpemU9IjEyIiBmaWxsPSIjMTZhMzRhIiBmb250LXdlaWdodD0iYm9sZCI+VE9UQUw6ICQ3MjA8L3RleHQ+PC9zdmc+',
                productos: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZjBmOWZmIi8+PHRleHQgeD0iNTAlIiB5PSI0MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSI0MCIgZmlsbD0iIzE2YTM0YSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+üçûü•ê</L3RleHQ+PHRleHQgeD0iNTAlIiB5PSI3MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzM3NDE1MSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+UHJvZHVjdG9zIEVudHJlZ2Fkb3M8L3RleHQ+PC9zdmc+',
                persona: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZWZmNmZmIi8+PHRleHQgeD0iNTAlIiB5PSI0MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSI0MCIgZmlsbD0iIzI1NjNlYiIgdGV4dC1hbmNob3I9Im1pZGRsZSI+üë§</L3RleHQ+PHRleHQgeD0iNTAlIiB5PSI3MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzM3NDE1MSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+Foto de Entrega</L3RleHQ+PC9zdmc+'
            };
            
            return ejemplos[tipo] || ejemplos.productos;
        }

        // Simular nuevas canastas cada 30 segundos para demo
        setInterval(() => {
            if (Math.random() < 0.3 && canastas.length < 5) {
                simularNuevaCanasta();
            }
        }, 30000);

        // Funci√≥n para verificar entregas duplicadas (validaci√≥n)
        function verificarEntregaDuplicada(nombre, metodo, identificador) {
            // En la implementaci√≥n real, esto verificar√≠a en la base de datos
            // si la persona ya retir√≥ una canasta hoy en este comercio
            
            const hoy = new Date().toDateString();
            // Simular verificaci√≥n...
            return false; // No duplicado para el demo
        }

        // Funci√≥n para validaci√≥n autom√°tica con IA (futuro)
        function validarFotosConIA(fotos) {
            // Esta funci√≥n implementar√≠a validaci√≥n con IA:
            // - Verificar que la foto del ticket es real
            // - Verificar que los productos coinciden
            // - Detectar si la foto de la persona es apropiada
            
            console.log('ü§ñ Validando fotos con IA...');
            
            // Por ahora, siempre retorna true (validaci√≥n autom√°tica)
            return new Promise((resolve) => {
                setTimeout(() => {
                    resolve({
                        valido: true,
                        confianza: 0.95,
                        observaciones: 'Ticket y productos v√°lidos detectados'
                    });
                }, 2000);
            });
        }

        // Inicializaci√≥n
        document.addEventListener('DOMContentLoaded', function() {
            // Cargar datos del comercio desde URL o localStorage
            const urlParams = new URLSearchParams(window.location.search);
            const comercioId = urlParams.get('comercio') || 'panaderia-san-juan-001';
            
            console.log(`üè™ Panel cargado para comercio: ${comercioId}`);
            
            // En la implementaci√≥n real:
            // - Cargar datos del comercio desde API
            // - Configurar WebSocket para actualizaciones en tiempo real
            // - Verificar autenticaci√≥n del comercio
        });

        // Funci√≥n para cerrar modal al hacer click fuera
        document.getElementById('entrega-form').addEventListener('click', function(e) {
            if (e.target === this) {
                cerrarFormularioEntrega();
            }
        });

        // Prevenir scroll del body cuando el modal est√° abierto
        document.addEventListener('touchmove', function(e) {
            if (document.getElementById('entrega-form').classList.contains('show')) {
                if (!e.target.closest('.form-container')) {
                    e.preventDefault();
                }
            }
        }, { passive: false });
    </script>
</body>
</html>
